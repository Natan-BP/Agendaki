{% extends 'base.html' %}

{% block content %}
<div class="flex items-center justify-center min-h-[85vh] py-10">
    <div class="w-full max-w-md bg-white rounded-lg border shadow-sm p-8">
        
        <div class="mb-8 text-center">
            <div class="inline-flex items-center justify-center h-12 w-12 rounded-full bg-blue-50 mb-4">
                <i data-lucide="user-plus" class="h-6 w-6 text-blue-600"></i>
            </div>
            <h1 class="text-2xl font-bold tracking-tight text-slate-900">Crie sua conta</h1>
            <p class="text-sm text-slate-500 mt-2">Escolha seu perfil para começar.</p>
        </div>

        <form method="post" class="space-y-4">
            {% csrf_token %}

            <style>
                input[type="text"], input[type="password"], input[type="email"] {
                    display: block;
                    width: 100%;
                    padding: 0.625rem 0.875rem;
                    font-size: 0.875rem;
                    color: #0f172a;
                    background-color: #ffffff;
                    border: 1px solid #e2e8f0;
                    border-radius: 0.375rem;
                    margin-top: 0.25rem;
                }
                label {
                    display: block;
                    font-size: 0.875rem;
                    font-weight: 500;
                    color: #334155;
                    margin-bottom: 0.25rem;
                    margin-top: 1rem;
                }
                .helptext { display: none; }
            </style>

            <div>
                <label for="{{ form.username.id_for_label }}">{{ form.username.label }}</label>
                {{ form.username }}
                {{ form.username.errors }}
            </div>

            <div>
                <label for="{{ form.email.id_for_label }}">{{ form.email.label }}</label>
                {{ form.email }}
                {{ form.email.errors }}
            </div>

            <div class="mt-4">
                <label class="mb-3 block">Eu sou:</label>
                
                <div class="grid grid-cols-2 gap-4">
                    {% for radio in form.role %}
                        <label class="cursor-pointer group relative">
                            <div class="sr-only">
                                {{ radio.tag }} 
                            </div>
                            
                            <div class="h-full p-4 rounded-lg border-2 border-slate-200 bg-white transition-all 
                                        hover:border-blue-400 hover:bg-slate-50
                                        flex flex-col items-center justify-center gap-2 text-center
                                        peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700">
                                
                                {% if "Aluno" in radio.choice_label %}
                                    <i data-lucide="graduation-cap" class="h-6 w-6 mb-1 text-slate-500 group-hover:text-blue-500 radio-icon"></i>
                                {% else %}
                                    <i data-lucide="presentation" class="h-6 w-6 mb-1 text-slate-500 group-hover:text-blue-500 radio-icon"></i>
                                {% endif %}
                                
                                <span class="font-semibold text-sm">{{ radio.choice_label }}</span>
                            </div>
                        </label>
                    {% endfor %}
                </div>
                {{ form.role.errors }}
            </div>

            <style>
                /* Quando o input (que está dentro do label) estiver checado, muda o estilo da div vizinha */
                /* Como não podemos usar peer direto facilmente no loop do Django sem mexer no widget, 
                   usamos este script simples para garantir a classe visual */
            </style>
            
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const radios = document.querySelectorAll('input[name="role"]');
                    
                    function updateVisuals() {
                        radios.forEach(radio => {
                            // Acha a div visual dentro do label pai
                            const visualDiv = radio.closest('label').querySelector('div:last-child');
                            const icon = visualDiv.querySelector('.radio-icon');
                            
                            if (radio.checked) {
                                visualDiv.classList.add('border-blue-600', 'bg-blue-50', 'text-blue-700');
                                visualDiv.classList.remove('border-slate-200', 'bg-white');
                                if(icon) icon.classList.add('text-blue-600');
                            } else {
                                visualDiv.classList.remove('border-blue-600', 'bg-blue-50', 'text-blue-700');
                                visualDiv.classList.add('border-slate-200', 'bg-white');
                                if(icon) icon.classList.remove('text-blue-600');
                            }
                        });
                    }

                    // Adiciona evento de clique
                    radios.forEach(r => r.addEventListener('change', updateVisuals));
                    // Roda uma vez no início
                    updateVisuals();
                });
            </script>
            <div class="space-y-4">
                
                <div>
                    <label for="{{ form.password1.id_for_label }}">Senha</label>
                    {{ form.password1 }}
                    
                    {% if form.password1.errors %}
                        <div class="mt-1 flex items-center text-red-600 text-xs font-medium animate-pulse">
                            <i data-lucide="alert-circle" class="h-3 w-3 mr-1"></i>
                            {{ form.password1.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div>
                    <label for="{{ form.password2.id_for_label }}">Confirmação de Senha</label>
                    {{ form.password2 }}
                    
                    {% if form.password2.errors %}
                        <div class="mt-1 flex items-center text-red-600 text-xs font-medium bg-red-50 p-2 rounded border border-red-100">
                            <i data-lucide="alert-triangle" class="h-4 w-4 mr-2"></i>
                            
                            {{ form.password2.errors.0 }} 
                            
                        </div>
                    {% endif %}
                </div>

                {% if form.non_field_errors %}
                    <div class="p-3 rounded-md bg-red-50 border border-red-100 text-sm text-red-600">
                        {% for error in form.non_field_errors %}
                            <p class="flex items-center">
                                <i data-lucide="x-circle" class="h-4 w-4 mr-2"></i>
                                {{ error }}
                            </p>
                        {% endfor %}
                    </div>
                {% endif %}

            </div>

            <div class="pt-4">
                <button type="submit" class="w-full inline-flex justify-center items-center rounded-md bg-slate-900 px-4 py-2.5 text-sm font-medium text-white hover:bg-slate-800 transition-colors shadow-sm">
                    Finalizar Cadastro
                    <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i>
                </button>
            </div>
        </form>

        <div class="mt-6 text-center text-sm">
            <span class="text-slate-500">Já tem uma conta?</span>
            <a href="{% url 'login' %}" class="font-medium text-slate-900 hover:text-blue-600 hover:underline ml-1 transition-colors">
                Fazer Login
            </a>
        </div>
    </div>
</div>
{% endblock %}